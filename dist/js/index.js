!function(t,s){function e(t){this.wrap=t,this.dataList=[],this.indexObj=null,this.rotateTimer=null,this.curIndex=0,this.list=null,this.progress=s.progress.pro(),this.curtime=null}e.prototype={init(){this.getDom(),this.getData("../mock/data.json")},getDom(){this.record=document.querySelector(".songImg img"),this.controlBtns=document.querySelectorAll(".control li")},getData(e){let i=this;t.ajax({url:e,method:"get",success:function(t){i.dataList=t,i.listPlay(),i.indexObj=new s.controlIndex(t.length),i.loadMusic(i.indexObj.index),i.musicControl(),i.dragProgress(),console.log(t)},error:function(){console.log("请求数据失败")}})},loadMusic(t){s.render(this.dataList[t]),s.music.load(this.dataList[t].audioSrc),this.progress.renderAlltime(this.dataList[t].duration),"play"==s.music.status&&(s.music.play(),console.log(this),this.controlBtns[2].className="playing",this.progress.move(0)),this.list.changeSelect(t),this.curIndex=t},musicControl(){let t=this;this.controlBtns[1].addEventListener("touchend",(function(){s.music.status="play",t.imgRotate(0),t.loadMusic(t.indexObj.prev())})),this.controlBtns[2].addEventListener("touchend",(function(){if("play"==s.music.status)s.music.pause(),this.className="",t.imgStop(),t.curtime=t.progress.stop()*t.dataList[t.indexObj.index].duration;else{s.music.play(),this.className="playing";let e=t.record.dataset.rotate||0;t.imgRotate(e),console.log(t.curtime),t.progress.move(t.curtime/t.dataList[t.indexObj.index].duration,!1)}})),this.controlBtns[3].addEventListener("touchend",(function(){s.music.status="play",t.imgRotate(0),t.loadMusic(t.indexObj.next())}))},imgRotate(t){let s=this;clearInterval(this.rotateTimer),this.rotateTimer=setInterval((function(){t=+t+.2,s.record.style.transform="rotate("+t+"deg)",s.record.dataset.rotate=t}),1e3/60)},imgStop(){clearInterval(this.rotateTimer)},listPlay(){let t=this;this.list=s.listControl(this.dataList,this.wrap),this.controlBtns[4].addEventListener("touchend",(function(){t.list.slideUp()})),this.list.musicList.forEach((e,i)=>{e.addEventListener("touchend",(function(){t.curIndex!=i&&(s.music.status="play",t.indexObj.index=i,t.loadMusic(i),t.imgRotate(0),t.list.slideDown())}))})},dragProgress(){let t=this,e=s.progress.drag(document.querySelector(".circle"));e.start=function(){t.progress.stop()},e.move=function(s){t.progress.update(s,!0)},e.end=function(e){t.curtime=e*t.dataList[t.indexObj.index].duration,console.log(t.curtime),s.music.playTo(t.curtime),"play"===s.music.status&&(s.music.play(),t.progress.move(e,!1))}},isAuto(){s.music.audio.ended&&(s.music.status="play",s.musicPlay.imgRotate(0),s.musicPlay.loadMusic(s.musicPlay.indexObj.next()))}};let i=new e(document.getElementById("wrap"));s.musicPlay=i,i.init()}(window.Zepto,window.player);